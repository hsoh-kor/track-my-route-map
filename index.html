<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kakao Map</title>
  <style>
    html, body, #map { margin:0; padding:0; width:100%; height:100%; }
  </style>
  <!-- YOUR_KAKAO_JS_KEY를 실제 키로 바꿔주세요 -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_JS_KEY"></script>
</head>
<body>
  <div id="map"></div>
  <script>
    // SDK 로드 체크
    if (!window.kakao || !window.kakao.maps) {
      document.body.innerHTML = '<p style="color:red;">Kakao SDK 로드 실패</p>';
    } else {
      // 초기 지도 생성
      window.map = new kakao.maps.Map(
        document.getElementById('map'),
        { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 5 }
      );
    }

    // 메시지 수신 핸들러
    function handleMessage(data) {
      if (!window.map) return;
      if (data.type === 'init') {
        map.setCenter(new kakao.maps.LatLng(data.lat, data.lng));
      }
      if (data.type === 'route') {
        if (window.polyline) polyline.setMap(null);
        const path = data.coords.map(c => new kakao.maps.LatLng(c.latitude, c.longitude));
        window.polyline = new kakao.maps.Polyline({ path, strokeWeight:5, strokeColor:'#FF0000' });
        polyline.setMap(map);
      }
      if (data.type === 'marker') {
        if (window.marker) marker.setMap(null);
        window.marker = new kakao.maps.Marker({
          position: new kakao.maps.LatLng(data.lat, data.lng),
          map
        });
      }
    }
    window.addEventListener('message', e => {
      try { handleMessage(JSON.parse(e.data)); } catch {}
    });
    document.addEventListener('message', e => {
      try { handleMessage(JSON.parse(e.data)); } catch {}
    });
  </script>
</body>
</html>
